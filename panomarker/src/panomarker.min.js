/**
 * @license Copyright 2014 â€” 2015 Martin Matysiak.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
!function(t,e){if("object"==typeof module&&"object"==typeof module.exports)module.exports=e();else if("function"==typeof define&&"object"==typeof define.amd)define(["goog!maps,3,other_params:[key=AIzaSyBEkMdsK8yWsTAt4NKUxRzXm_57spy6Tqw&sensor=false&libraries=visualization]"],e);else{if("object"!=typeof google||"object"!=typeof google.maps)throw new Error("PanoMarker requires google maps library");t.PanoMarker=e()}}("undefined"!=typeof window?window:this,function(){var t=function(t){t=t||{},this.anchor_=t.anchor||new google.maps.Point(16,16),this.className_=t.className||null,this.clickable_=t.clickable||!0,this.icon_=t.icon||null,this.id_=t.id||null,this.marker_=null,this.pano_=null,this.pollId_=-1,this.position_=t.position||{heading:0,pitch:0},this.povListener_=null,this.zoomListener_=null,this.size_=t.size||new google.maps.Size(32,32),this.title_=t.title||"",this.visible_=t.visible||!0,this.zIndex_=t.zIndex||1,this.setPano(t.pano||null)};return t.prototype=new google.maps.OverlayView,t.get3dFov=function(t){return 2>=t?126.5-36.75*t:195.93/Math.pow(1.92,t)},t.povToPixel3d=function(e,i,o,s){var n=s.offsetWidth,r=s.offsetHeight,a={left:n/2,top:r/2},h=Math.PI/180,l=t.get3dFov(o)*h,p=i.heading*h,c=i.pitch*h,d=e.heading*h,_=e.pitch*h,u=n/2/Math.tan(l/2),m=Math.cos(_),f=Math.sin(_),g=Math.cos(d),y=Math.sin(d),w=u*m*y,v=u*m*g,k=u*f,b=Math.cos(c),P=Math.sin(c),x=Math.cos(p),z=Math.sin(p),M=u*b*z,I=u*b*x,N=u*P,L=M*w+I*v+N*k,T=M*M+I*I+N*N;if(Math.abs(L)<1e-6)return null;var C=T/L;if(0>C)return null;var S=C*w,E=C*v,A=C*k,j=-P*z,V=-P*x,H=b,Z=x,q=-z,R=0,W=Math.sqrt(Z*Z+q*q+R*R);Z/=W,q/=W,R/=W;var B=S*Z+E*q+A*R,F=S*j+E*V+A*H;return a.left+=B,a.top-=F,a},t.wrapHeading=function(t){return t=(t+180)%360,0>t&&(t+=360),t-180},t.povToPixel2d=function(e,i,o,s){var n=s.offsetWidth,r=s.offsetHeight,a={left:n/2,top:r/2},h=180/Math.pow(2,o),l=h*(r/n),p=t.wrapHeading(e.heading-i.heading),c=e.pitch-i.pitch;return a.left+=p/h*n,a.top-=c/l*r,a},t.prototype.onAdd=function(){if(!this.marker_){var t=document.createElement("div");t.style.position="absolute",t.style.cursor="pointer",t.style.width=this.size_.width+"px",t.style.height=this.size_.height+"px",t.style.display=this.visible_?"block":"none",t.style.zIndex=this.zIndex_,this.id_&&(t.id=this.id_),this.className_&&(t.className=this.className_),this.title_&&(t.title=this.title_),this.icon_&&(t.style.backgroundImage="url("+this.icon_+")"),this.id_||this.className_||this.icon_||(t.style.backgroundImage="url(https://www.google.com/intl/en_us/mapfiles/ms/micons/red-dot.png)"),this.marker_=t,this.getPanes().overlayMouseTarget.appendChild(t),window.addEventListener("resize",this.draw.bind(this)),this.povListener_=google.maps.event.addListener(this.getMap(),"pov_changed",this.draw.bind(this)),this.zoomListener_=google.maps.event.addListener(this.getMap(),"zoom_changed",this.draw.bind(this));var e="click";window.PointerEvent?e="pointerdown":window.MSPointerEvent&&(e="MSPointerDown"),t.addEventListener(e,this.onClick.bind(this),!1),this.draw()}},t.prototype.draw=function(){if(this.pano_){var t=this.povToPixel_(this.position_,this.pano_.getPov(),null!==this.pano_.getZoom()?this.pano_.getZoom():1,this.pano_.getContainer());null!==t?(this.marker_.style.left=t.left-this.anchor_.x+"px",this.marker_.style.top=t.top-this.anchor_.y+"px"):(this.marker_.style.left=-(9999+this.size_.width)+"px",this.marker_.style.top="0")}},t.prototype.onClick=function(t){this.clickable_&&google.maps.event.trigger(this,"click"),t.cancelBubble=!0,t.stopPropagation&&t.stopPropagation()},t.prototype.onRemove=function(){this.marker_&&(google.maps.event.removeListener(this.povListener_),google.maps.event.removeListener(this.zoomListener_),this.marker_.parentNode.removeChild(this.marker_),this.marker_=null)},t.prototype.getAnchor=function(){return this.anchor_},t.prototype.getClassName=function(){return this.className_},t.prototype.getClickable=function(){return this.clickable_},t.prototype.getIcon=function(){return this.icon_},t.prototype.getId=function(){return this.id_},t.prototype.getPano=function(){return this.pano_},t.prototype.getPosition=function(){return this.position_},t.prototype.getSize=function(){return this.size_},t.prototype.getTitle=function(){return this.title_},t.prototype.getVisible=function(){return this.visible_},t.prototype.getZIndex=function(){return this.zIndex_},t.prototype.setAnchor=function(t){this.anchor_=t,this.draw()},t.prototype.setClassName=function(t){this.className_=t,this.marker_&&(this.marker_.className=t)},t.prototype.setClickable=function(t){this.clickable_=t},t.prototype.setIcon=function(t){this.icon_=t,this.marker_&&(this.marker_.style.backgroundImage=t?"url("+t+")":"")},t.prototype.setId=function(t){this.id_=t,this.marker_&&(this.marker_.id=t)},t.prototype.setPano=function(e){if(e&&!(e instanceof google.maps.StreetViewPanorama))throw"PanoMarker only works inside a StreetViewPanorama.";if(this.povToPixel_=e&&("webgl"===e.mode||"html5"===e.mode||!e.mode&&window.chrome)||!e&&window.chrome?t.povToPixel3d:t.povToPixel2d,this.pano_&&this.onRemove(),this.setMap(e),this.pano_=e,e){var i=function(t){var e=function(){this.getPanes()&&(window.clearInterval(this.pollId_),this.onAdd(),t&&t(this))};this.pollId_=window.setInterval(e.bind(this),10)};if("undefined"!=typeof Promise)return new Promise(i.bind(this));i.call(this)}},t.prototype.setPosition=function(t){this.position_=t,this.draw()},t.prototype.setSize=function(t){this.size_=t,this.marker_&&(this.marker_.style.width=t.width+"px",this.marker_.style.height=t.height+"px",this.draw())},t.prototype.setTitle=function(t){this.title_=t,this.marker_&&(this.marker_.title=t)},t.prototype.setVisible=function(t){this.visible_=t,this.marker_&&(this.marker_.style.display=t?"block":"none")},t.prototype.setZIndex=function(t){this.zIndex_=t,this.marker_&&(this.marker_.style.zIndex=t)},t});
